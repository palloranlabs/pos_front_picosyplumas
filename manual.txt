ðŸ“˜ Frontend Development Manual: Picos y Plumas POS (v2.0)

Version: 2.0 (Strict API Alignment) Project: Point of Sale System (POS API Pro Client) Theme: "Tropical Professional" (Light UI)
1. Project Overview

The goal is to build a responsive, robust web-based Point of Sale interface that interacts with the POS API Pro (FastAPI). The system is divided into two major environments:

    Cashier View (POS): Optimized for speed, touch inputs, decimal precision, and thermal printing.

    Admin View: Product management and sales reporting (protected by Master Password logic).

2. Technology Stack & Best Practices

    Framework: React (Vite) + TypeScript (Strict Mode is Mandatory).

    Styling: Tailwind CSS (configured with Brand Palette).

    State Management: Zustand (preferred for simplicity/performance).

    Data Validation: Zod (Mandatory for form inputs and API response validation).

    HTTP Client: Axios (with strict Interceptors for Auth/Refresh).

    Icons: Lucide-React or Heroicons (Rounded style).

    Routing: React Router DOM v6.

3. Design System & Theme Configuration
3.1 Color Palette (Strict)

Do not use default Tailwind colors for primary actions. You must configure tailwind.config.js to use these exact hex codes.
Color Name	Hex Code	Usage Guideline
brand-navy	#002e9c	Typography/Anchor. Main headers, bold text.
brand-blue	#0073bc	Interactive. Buttons, input borders, focus rings.
brand-green	#3ec800	Success. "Add to Cart", "Session Open", Success toasts.
brand-yellow	#ffab22	Warning. Low stock. Start color of Pay Gradient.
brand-red	#e63946	Danger. Delete items, Close Session, Errors. End Pay Gradient.
brand-purple	#ab117d	Admin. Sidebar accents, special badges.
3.2 Tailwind Configuration
JavaScript

// tailwind.config.js
module.exports = {
  theme: {
    extend: {
      colors: {
        brand: {
          navy: '#002e9c',
          blue: '#0073bc',
          green: '#3ec800',
          yellow: '#ffab22',
          red: '#e63946',
          purple: '#ab117d',
        }
      },
      fontFamily: {
        sans: ['Nunito', 'sans-serif'], // UI Headings
        body: ['Inter', 'sans-serif'],   // Data & Grids
        mono: ['Courier Prime', 'monospace'], // STRICTLY for Thermal Tickets
      }
    }
  }
}

4. Architecture & Data Models
4.1 Critical: Decimal Handling Strategy

The API returns all monetary values (prices, subtotals, totals) as Strings to prevent floating-point math errors.

    Frontend Rule: You must parse strings to floats for calculation but send strings back to the API.

    Formatting: Always display 2 decimal places.

Required Utility (src/utils/currency.ts):
TypeScript

export const parseDecimal = (value: string | number): number => {
  return typeof value === 'string' ? parseFloat(value) : value;
};

export const formatCurrency = (value: string | number): string => {
  const num = parseDecimal(value);
  return new Intl.NumberFormat('es-MX', {
    style: 'currency',
    currency: 'MXN'
  }).format(num);
};

// Regex for Zod Validation (matches API requirement)
export const DECIMAL_REGEX = /^(?!^[-+.]*$)[+-]?0*(?:\d{0,8}|(?=[\d.]{1,11}0*$)\d{0,8}\.\d{0,2}0*$)/;

4.2 TypeScript Interfaces (Strict)

These must match openapi.json exactly.
TypeScript

// src/types/models.types.ts

// Product
export interface Product {
  id: number;
  name: string;
  description?: string | null;
  base_price: string; // COMES AS STRING
  is_active: boolean;
}

// Sale Item
export interface SaleItem {
  id: number;
  product_id: number;
  product_name_snapshot: string;
  unit_price_snapshot: string; // String
  quantity: string;            // String
  discount_percent: string;    // String
  item_subtotal: string;       // String
}

// Sale (Ticket)
export interface Sale {
  id: number;
  ticket_number: string;
  subtotal: string;
  tax_amount: string;
  total_amount: string;
  payment_method: 'cash' | 'card' | 'mixed';
  cash_received: string;
  change_given: string;
  is_refunded: boolean;
  created_at: string; // ISO Date
  items: SaleItem[];
}

5. API Layer & Security
5.1 Axios Client with Auto-Refresh

Create src/api/client.ts. This handles the OAuth2 Bearer flow and 401 Unauthorized errors automatically.
TypeScript

import axios from 'axios';
import { useAuthStore } from '../stores/useAuthStore';

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL,
});

// 1. Request Interceptor: Inject Token
api.interceptors.request.use((config) => {
  const token = useAuthStore.getState().accessToken;
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 2. Response Interceptor: Handle 401 Refresh
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;
    
    // If 401 and we haven't retried yet
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      try {
        const refreshToken = useAuthStore.getState().refreshToken;
        // Call refresh endpoint
        const { data } = await axios.post(`${import.meta.env.VITE_API_URL}/api/v1/auth/refresh-token`, {
          refresh_token: refreshToken
        });
        
        // Update Store
        useAuthStore.getState().setTokens(data);
        
        // Retry original request
        originalRequest.headers.Authorization = `Bearer ${data.access_token}`;
        return api(originalRequest);
      } catch (refreshError) {
        // Refresh failed - Force Logout
        useAuthStore.getState().logout();
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }
    return Promise.reject(error);
  }
);

export default api;

6. View Specifications & Functional Logic
6.1 Cashier Dashboard (POS)

Layout: Two Columns (Left: Product Grid 66%, Right: Cart 33%).
A. Product Grid

    Search: Auto-focused input. Border brand-blue.

    Logic: Fetch GET /products/.

    Card: Display name, base_price (formatted). Click to Add.

B. The Cart (State Management)

The Cart logic must handle the conversion between strings and numbers.

    Store (useCartStore.ts):

        State: items: { product: Product, quantity: number, discount: number }[]

        Calculations:

            Subtotal = Î£ (Price Ã— Qty Ã— (1 - Discount%))

            Tax = Subtotal Ã— 0.16 (Example, adjust based on business logic if backend handles tax)

            Total = Subtotal + Tax

    Discount Logic:

        Add a "Discount" button/icon on cart items.

        Action: Clicking opens a modal requesting the Master Password.

        Validation: If password correct, allow entering discount_percent (0-100).

C. Checkout Flow (Pay Button)

    Trigger: Click large Gradient Button (brand-yellow to brand-red).

    Modal:

        Select Method: Cash, Card, Mixed.

        Input: cash_received (Required if method is Cash/Mixed).

        Auto-Calc: Display Change (Cash Received - Total).

    Submission (POST /api/v1/sales/):

        Payload Construction:
        JSON

        {
          "items": [
             { "product_id": 1, "quantity": "2", "discount_percent": 0 }
          ],
          "payment_method": "cash",
          "cash_received": "500.00",
          "master_password": null // Only send if global discount applied
        }

    Success:

        Save Sale object to state.

        Auto-Print: Mount the <TicketTemplate /> and trigger window.print().

        Clear Cart.

6.2 Session Management

The API requires an open session.

    App Load: Check if opening_balance exists in local storage or handle 422 errors from sales endpoints.

    Open Session:

        Modal: "Start Shift".

        Input: opening_balance (number).

        API: POST /api/v1/cash/open.

    Close Session:

        Button: "End Shift" (Navbar).

        Input: closing_balance.

        API: POST /api/v1/cash/close.

6.3 Admin Panel (Protected)

    Route: /admin/*.

    Product Manager:

        Table View of Products.

        Create: POST /products/ (Validate decimalPattern).

        Update: PUT /products/{id}.

            Crucial: Updating a product requires Master Password.

            UI: When clicking "Save", open a modal: "Enter Master Password to confirm changes".

            Send master_password in the PUT body.

7. Ticket Printing Module (50mm Thermal)

Use a dedicated component that is hidden from the UI but visible to the printer.

Component: src/components/pos/TicketTemplate.tsx
TypeScript

import React from 'react';
import { Sale } from '../../types/models.types';

interface Props {
  sale: Sale | null;
}

export const TicketTemplate: React.FC<Props> = ({ sale }) => {
  if (!sale) return null;

  return (
    <div id="printable-area" className="hidden print:block fixed top-0 left-0 w-[50mm] bg-white text-black font-mono text-[11px] leading-tight">
      <div className="text-center mb-2">
        <h2 className="font-bold text-sm">Picos y Plumas</h2>
        <p>Ticket: #{sale.ticket_number}</p>
        <p>{new Date(sale.created_at).toLocaleString()}</p>
      </div>
      
      <hr className="border-dashed border-black my-1"/>
      
      {sale.items.map((item) => (
         <div key={item.id} className="flex justify-between mb-1">
           <div className="flex flex-col">
             <span>{item.product_name_snapshot}</span>
             <span className="text-[9px]">{item.quantity} x ${item.unit_price_snapshot}</span>
           </div>
           <span>${item.item_subtotal}</span>
         </div>
      ))}
      
      <hr className="border-dashed border-black my-1"/>
      
      <div className="flex justify-between font-bold text-xs">
         <span>TOTAL</span>
         <span>${sale.total_amount}</span>
      </div>
      
      <div className="text-right text-[10px] mt-1">
         <p>Efectivo: ${sale.cash_received}</p>
         <p>Cambio: ${sale.change_given}</p>
      </div>
    </div>
  );
};

CSS (src/print.css):
CSS

@media print {
  body * {
    visibility: hidden;
    height: 0;
    overflow: hidden;
  }
  #printable-area, #printable-area * {
    visibility: visible;
    height: auto;
  }
  @page {
    size: 58mm auto; /* Adjust to 50mm or 58mm depending on printer */
    margin: 0;
  }
}

8. Directory Structure
Plaintext

src/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ client.ts         # Axios + Interceptors
â”‚   â”œâ”€â”€ auth.api.ts       # Login, Refresh
â”‚   â”œâ”€â”€ products.api.ts   # CRUD
â”‚   â”œâ”€â”€ sales.api.ts      # POS Transaction + Refunds
â”‚   â””â”€â”€ cash.api.ts       # Open/Close Session
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ common/           # Button, Input, Modal, Card
â”‚   â”œâ”€â”€ pos/
â”‚   â”‚   â”œâ”€â”€ ProductGrid.tsx
â”‚   â”‚   â”œâ”€â”€ CartWidget.tsx
â”‚   â”‚   â”œâ”€â”€ PayModal.tsx  # Handles Payment + Master Password
â”‚   â”‚   â””â”€â”€ TicketTemplate.tsx
â”‚   â””â”€â”€ admin/            # ProductTable (w/ Password Prompt)
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ usePrinter.ts     # window.print() trigger
â”‚   â””â”€â”€ useSales.ts       # React Query hooks (optional)
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ useAuthStore.ts   # Tokens
â”‚   â”œâ”€â”€ useCartStore.ts   # Logic for subtotal/tax/total
â”‚   â””â”€â”€ useSessionStore.ts
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ api.types.ts      # HTTPValidationError
â”‚   â””â”€â”€ models.types.ts   # Product, Sale (Strict Interfaces)
â””â”€â”€ utils/
    â”œâ”€â”€ currency.ts       # parseDecimal, formatCurrency
    â””â”€â”€ validators.ts     # Zod Schemas

9. Developer Checklist

    [ ] Setup: Install axios, zustand, zod, clsx, lucide-react.

    [ ] Config: Update tailwind.config.js with Brand Colors.

    [ ] Auth: Implement Login with access_token storage and auto-refresh logic.

    [ ] Models: Ensure base_price and monetary fields are treated as string in interfaces but parsed for math.

    [ ] Validation: Apply Zod regex DECIMAL_REGEX to all price inputs.

    [ ] POS: Build Cart with Discount logic (Master Password protection).

    [ ] Admin: Implement Product Update with Master Password confirmation.

    [ ] Print: Verify 50mm layout using browser "Emulate Print" devtools.